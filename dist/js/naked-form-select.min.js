/* Naked Form Select v1.2.0 (https://github.com/developerdayo/naked-form-select)
 * Copyright 2019-2020 Sarah Ferguson
 * Licensed under MIT (https://github.com/developerdayo/naked-form-select/LICENSE) */
"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}var nakedFormSelect=function(e,t){var d,f,u,n=0<arguments.length&&void 0!==e?e:"select",o=1<arguments.length&&void 0!==t?t:{},a=o.events,p=void 0===a?{open:void 0,close:void 0}:a,r=o.settings,i=void 0===r?{dropupThreshold:50}:r,l=o.context,c=void 0===l?{value:void 0,queryDocument:!1}:l,s=o.keywordSearch,m=void 0===s?{on:!1,placeholder:void 0}:s,b=o.submitBtn,y=void 0===b?{on:!1,text:void 0}:b;void 0===c.queryDocument?c.queryDocument=!1:c.queryDocument=c.queryDocument;var v=i.dropupThreshold,g={index:function(){setTimeout(function(){_toConsumableArray(d.querySelectorAll("[data-naked-select-id]")).forEach(function(e,t){e.setAttribute("data-index",t)})},1)},submitBtn:function(){var e,t=document.createElement("button");return e=void 0===y.text?y.text="submit":y.text,t.textContent=e,t.classList.add("naked-submit"),t.setAttribute("tabindex","-1"),t.addEventListener("click",function(e){e.target.closest("form").submit()}),t},keywordSearchInput:function(){var e=document.createElement("div");e.classList.add("keyword-search-wrap");var t=document.createElement("input");return t.setAttribute("aria-label","Enter a keyword to reduce the list of options"),void 0!==m.placeholder&&t.setAttribute("placeholder",m.placeholder),e.appendChild(t),e},lists:function(){_toConsumableArray(d.querySelectorAll(f)).forEach(function(e,t){if(!e.getAttribute("data-initialized")){var n,o=Array.from(e.childNodes).filter(function(e){return"OPTION"===e.nodeName});"true"===e.getAttribute("data-label")&&(n=o[0],o.shift());var a,r=[];o.forEach(function(e){r.push([e.index,e.textContent])}),a="true"===e.getAttribute("data-label")?n.textContent:o[0].textContent;var i=document.createElement("button");i.classList.add("toggle-dropdown"),i.setAttribute("aria-label","Click to expand options"),i.textContent=a,i.setAttribute("type","button");var l=document.createElement("div");l.classList.add("options-wrap"),l.setAttribute("tabindex","-1");var c=document.createElement("ul");c.setAttribute("data-naked-select-list",t),r.forEach(function(e){var t=document.createElement("li");t.setAttribute("data-index",e[0]),t.setAttribute("tabindex","0"),t.appendChild(document.createTextNode(e[1])),c.appendChild(t)}),l.appendChild(c);var s=document.createElement("div");if(s.classList.add("naked-form-select-wrap"),s.setAttribute("data-naked-select-id",f),s.setAttribute("data-naked-select",t),s.appendChild(i),s.appendChild(l),e.parentNode.insertBefore(s,e),s.appendChild(e),!0===m.on){var d=g.keywordSearchInput();c.insertAdjacentElement("beforebegin",d)}if(!0===y.on){var u=g.submitBtn();c.insertAdjacentElement("afterend",u)}h.validationError(e),g.index()}})},currentState:function(){_toConsumableArray(d.querySelectorAll("".concat(u,"[data-naked-select] select"))).forEach(function(t,e){if(!t.getAttribute("data-initialized")){var n=Array.from(t.parentNode.childNodes).filter(function(e){return e.classList.contains("toggle-dropdown")})[0];if(t.multiple){var o=Array.from(t.options).filter(function(e){return!0===e.selected});"true"===t.getAttribute("data-label")&&(o=o.filter(function(e){return 0!==e.index}));var a,r=t.options.selectedIndex;o.forEach(function(e){t.previousElementSibling.querySelector("li[data-index='".concat(e.index,"']")).classList.add("selected")}),-1===t.options.selectedIndex?n.textContent=t.options[0].textContent:"false"===t.getAttribute("data-pluralize")&&null!==t.getAttribute("data-multiple-keyword")&&1<o.length?(a=t.getAttribute("data-multiple-keyword"),n.textContent="".concat(o.length," ").concat(a," selected")):null!==t.getAttribute("data-multiple-keyword")&&1<o.length?(a=t.getAttribute("data-multiple-keyword")+"s",n.textContent="".concat(o.length," ").concat(a," selected")):1<o.length?(a="items",n.textContent="".concat(o.length," ").concat(a," selected")):(a="items",n.textContent=t.options[r].textContent)}else{var i=t.options.selectedIndex;"true"===t.getAttribute("data-label")&&0===i?n.textContent=t.options[0].textContent:(n.textContent=t.options[i].textContent,t.previousElementSibling.querySelector('li[data-index="'.concat(i,'"]')).classList.add("selected"))}t.setAttribute("data-initialized","true")}})}},h={triggerEvent:function(e,t){if("createEvent"in document){var n=document.createEvent("HTMLEvents");n.initEvent(t,!1,!0),e.dispatchEvent(n)}},globalClose:function(){document.querySelector("body").addEventListener("click",function(t){p.close||_toConsumableArray(document.querySelectorAll("[data-naked-select]")).filter(function(e){return!e.contains(t.target)}).forEach(function(e){e.classList.remove("open");var t=e.querySelector(".options-wrap");t.setAttribute("tabindex","-1"),setTimeout(function(){e.classList.remove("dropup")},255),t.style.height="0"})})},toggle:function(i){_toConsumableArray(d.querySelectorAll("".concat(u,"[data-naked-select]"))).forEach(function(r){_toConsumableArray(r.querySelectorAll(".toggle-dropdown")).forEach(function(e){var t=e.parentNode.getAttribute("data-naked-select"),o=d.querySelector("".concat(u,"[data-naked-select='").concat(t,"']")),a=d.querySelector("".concat(u,"[data-naked-select='").concat(t,"'] .options-wrap"));r.setAttribute("data-keydown-event","initialized"),r.setAttribute("data-click-event","initialized"),a.style.height="0",e.addEventListener(i,function(n){function e(){o.classList.add("open"),a.setAttribute("tabindex","0");var e=window.innerHeight,t=window.scrollY;e-(window.scrollY+n.target.getBoundingClientRect().top+n.target.offsetHeight)+t<v&&(n.target.parentNode.classList.add("dropup"),n.target.nextSibling.style.bottom="".concat(n.target.offsetHeight,"px")),r.querySelector(".naked-submit")&&r.querySelector(".naked-submit").setAttribute("tabindex","0"),"function"==typeof p.open&&p.open?p.open(a):a.style.height=null}function t(){o.classList.remove("open"),a.setAttribute("tabindex","-1"),n.target.parentNode.classList.remove("dropup"),r.querySelector(".naked-submit")&&r.querySelector(".naked-submit").setAttribute("tabindex","-1"),"function"==typeof p.close&&p.close?p.close(a):a.style.height="0"}if("keydown"===i){if(n.keyCode===[0,32])e();else if(40===n.keyCode){(listItemIds.indexOf(activeElementId)<listItemIds.length-1).querySelector("ul li:first-child").focus()}else 27===n.keyCode&&t()}else"click"===i&&(n.preventDefault(),o.classList.contains("open")?t():e())}),r.setAttribute("data-initialized","true")},h.globalClose())})},addValidationMessage:function(e){if(!e.querySelector(".naked-form-select-wrap--error-message")){e.classList.add("error");var t=document.createElement("div");t.classList.add("naked-form-select-wrap--error-message"),t.textContent="Please make a selection",e.insertBefore(t,e.childNodes[0])}},removeValidationMessage:function(e){if(e.classList.contains("error")){e.classList.remove("error");var t=e.querySelector(".naked-form-select-wrap--error-message");e.removeChild(t)}},validationError:function(n){var e=n.closest("form");e&&e.querySelector('[type="submit"]')&&e.querySelector('[type="submit"]').addEventListener("click",function(e){var t=n.parentNode;n.checkValidity()?h.removeValidationMessage(t):h.addValidationMessage(t)})},select:function(){_toConsumableArray(d.querySelectorAll("".concat(u,"[data-naked-select] li"))).forEach(function(s){s.addEventListener("click",function(){var e=parseInt(s.getAttribute("data-index")),t=s.textContent,n=s.parentNode.getAttribute("data-naked-select-list"),o=d.querySelector("".concat(u,"[data-naked-select='").concat(n,"'] select"));o.options[e].selected=!0,h.triggerEvent(o,"change");var a=d.querySelector("".concat(u,"[data-naked-select='").concat(n,"'] .toggle-dropdown"));if(o.multiple){s.classList.contains("selected")?(s.classList.remove("selected"),o.options[e].selected=!1):(s.classList.add("selected"),o.options[e].selected=!0);var r,i=Array.from(o.options).filter(function(e){return!0===e.selected});if("true"===o.getAttribute("data-label")&&(i=i.filter(function(e){return 0!==e.index})),1<i.length)i.forEach(function(e){"true"===o.getAttribute("data-label")&&0===e.index||o.previousElementSibling.querySelector('li[data-index="'.concat(e.index,'"]')).classList.add("selected")}),r=null!==o.getAttribute("data-multiple-keyword")&&"false"===o.getAttribute("data-pluralize")?o.getAttribute("data-multiple-keyword"):null!==o.getAttribute("data-multiple-keyword")?"".concat(o.getAttribute("data-multiple-keyword"),"s"):"items",a.textContent="".concat(i.length," ").concat(r," selected");else 1===i.length&&(a.textContent=i[0].text);0===i.length&&(a.textContent=o.options[0].textContent)}else{var l=d.querySelector("".concat(u,"[data-naked-select='").concat(n,"']")),c=d.querySelector("".concat(u,"[data-naked-select='").concat(n,"'] .options-wrap"));l.classList.contains("open")?(l.classList.remove("open"),c.setAttribute("tabindex","-1"),"function"==typeof p.close&&p.close?p.close(c):c.style.height="0"):(l.classList.add("open"),c.setAttribute("tabindex","0"),"function"==typeof p.open&&p.open?p.open(c):c.style.height=null),_toConsumableArray(d.querySelectorAll("".concat(u,"[data-naked-select='").concat(n,"'] li"))).forEach(function(e){e.classList.remove("selected")}),s.classList.contains("selected")?s.classList.remove("selected"):s.classList.add("selected"),a.textContent=t}o.getAttribute("required")&&0!==o.selectedIndex&&h.removeValidationMessage(d.querySelector("".concat(u,"[data-naked-select='").concat(n,"']")))})})},keywordSearch:function(){!0===m.on&&(_toConsumableArray(d.querySelectorAll(u)).forEach(function(e){e.setAttribute("keywordSearch","on")}),_toConsumableArray(d.querySelectorAll(f)).forEach(function(e,o){var t=[],a=Array.from(e.childNodes).filter(function(e){return"OPTION"===e.nodeName});a.forEach(function(e){t.push(e.textContent)});var n=e.previousElementSibling.childNodes[0].childNodes[0],r=(e.previousElementSibling.childNodes[1],_toConsumableArray(d.querySelectorAll("[data-naked-select-id='".concat(f,"'] .options-wrap li"))));r.forEach(function(e){e.classList.add("match")}),n.addEventListener("input",function(e){var t=e.target.value.toLowerCase(),n=a.filter(function(e){if(e.textContent.toLowerCase().match(t))return e});r.forEach(function(e){e.classList.remove("match")}),n.forEach(function(t){r.forEach(function(e){parseInt(e.getAttribute("data-index"))===t.index&&e.classList.add("match")})}),d.querySelector("".concat(u,"[data-naked-select='").concat(o,"'] .options-wrap")).style.height=null})}))}};d=void 0!==c.value&&!1===c.queryDocument?c.value:void 0!==c.value&&!0===c.queryDocument?document.querySelector(c.value):document,u="[data-naked-select-id='".concat(f=n,"']"),g.lists(),g.currentState(),h.toggle("keydown"),h.toggle("click"),h.select(),h.keywordSearch()};"undefined"!=typeof module&&(module.exports=nakedFormSelect);