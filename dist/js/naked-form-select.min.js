/* Naked Form Select v1.1.5 (https://github.com/developerdayo/naked-form-select)
 * Copyright 2019-2020 Sarah Ferguson
 * Licensed under MIT (https://github.com/developerdayo/naked-form-select/LICENSE) */
"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}var nakedFormSelect=function(t,e){var s,f,u,n=0<arguments.length&&void 0!==t?t:"select",a=1<arguments.length&&void 0!==e?e:{},r=a.settings,o=void 0===r?{dropupThreshold:50}:r,i=a.context,c=void 0===i?{value:void 0,queryDocument:!1}:i,l=a.keywordSearch,m=void 0===l?{on:!1,placeholder:void 0}:l,d=a.submitBtn,p=void 0===d?{on:!1,text:void 0}:d;void 0===c.queryDocument?c.queryDocument=!1:c.queryDocument=c.queryDocument;var b=o.dropupThreshold,g={index:function(){setTimeout(function(){_toConsumableArray(s.querySelectorAll("[data-naked-select-id]")).forEach(function(t,e){t.setAttribute("data-index",e)})},1)},submitBtn:function(){var t,e=document.createElement("button");return t=void 0===p.text?p.text="submit":p.text,e.textContent=t,e.classList.add("naked-submit"),e.setAttribute("tabindex","-1"),e.addEventListener("click",function(t){t.target.closest("form").submit()}),e},keywordSearchInput:function(){var t=document.createElement("div");t.classList.add("keyword-search-wrap");var e=document.createElement("input");return e.setAttribute("aria-label","Enter a keyword to reduce the list of options"),void 0!==m.placeholder&&e.setAttribute("placeholder",m.placeholder),t.appendChild(e),t},lists:function(){_toConsumableArray(s.querySelectorAll(f)).forEach(function(t,e){if(!t.getAttribute("data-initialized")){var n,a=Array.from(t.childNodes).filter(function(t){return"OPTION"===t.nodeName});"true"===t.getAttribute("data-label")&&(n=a[0],a.shift());var r,o=[];a.forEach(function(t){o.push([t.index,t.textContent])}),r="true"===t.getAttribute("data-label")?n.textContent:a[0].textContent;var i=document.createElement("button");i.classList.add("toggle-dropdown"),i.setAttribute("aria-label","Click to expand options"),i.textContent=r,i.setAttribute("type","button");var c=document.createElement("div");c.classList.add("options-wrap"),c.setAttribute("tabindex","-1");var l=document.createElement("ul");l.setAttribute("data-naked-select-list",e),o.forEach(function(t){var e=document.createElement("li");e.setAttribute("data-index",t[0]),e.appendChild(document.createTextNode(t[1])),l.appendChild(e)}),c.appendChild(l);var d=document.createElement("div");if(d.classList.add("naked-form-select-wrap"),d.setAttribute("data-naked-select-id",f),d.setAttribute("data-naked-select",e),d.appendChild(i),d.appendChild(c),t.parentNode.insertBefore(d,t),d.appendChild(t),!0===m.on){var s=g.keywordSearchInput();l.insertAdjacentElement("beforebegin",s)}if(!0===p.on){var u=g.submitBtn();l.insertAdjacentElement("afterend",u)}v.validationError(t),g.index()}})},currentState:function(){_toConsumableArray(s.querySelectorAll("".concat(u,"[data-naked-select] select"))).forEach(function(e,t){if(!e.getAttribute("data-initialized")){var n=Array.from(e.parentNode.childNodes).filter(function(t){return t.classList.contains("toggle-dropdown")})[0];if(e.multiple){var a=Array.from(e.options).filter(function(t){return!0===t.selected});"true"===e.getAttribute("data-label")&&(a=a.filter(function(t){return 0!==t.index}));var r,o=e.options.selectedIndex;a.forEach(function(t){e.previousElementSibling.querySelector("li[data-index='".concat(t.index,"']")).classList.add("selected")}),-1===e.options.selectedIndex?n.textContent=e.options[0].textContent:"false"===e.getAttribute("data-pluralize")&&null!==e.getAttribute("data-multiple-keyword")&&1<a.length?(r=e.getAttribute("data-multiple-keyword"),n.textContent="".concat(a.length," ").concat(r," selected")):null!==e.getAttribute("data-multiple-keyword")&&1<a.length?(r=e.getAttribute("data-multiple-keyword")+"s",n.textContent="".concat(a.length," ").concat(r," selected")):1<a.length?(r="items",n.textContent="".concat(a.length," ").concat(r," selected")):(r="items",n.textContent=e.options[o].textContent)}else{var i=e.options.selectedIndex;"true"===e.getAttribute("data-label")&&0===i?n.textContent=e.options[0].textContent:(n.textContent=e.options[i].textContent,e.previousElementSibling.querySelector('li[data-index="'.concat(i,'"]')).classList.add("selected"))}e.setAttribute("data-initialized","true")}})}},v={triggerEvent:function(t,e){if("createEvent"in document){var n=document.createEvent("HTMLEvents");n.initEvent(e,!1,!0),t.dispatchEvent(n)}},globalClose:function(){document.querySelector("body").addEventListener("click",function(r){for(var o=Array.from(document.querySelectorAll("[data-naked-select]")),t=function(t){if(o[t].classList.contains("open")&&!o[t].contains(r.target)){var e=parseInt(o[t].getAttribute("data-index")),n=o[t].getAttribute("data-naked-select-id");o[t].classList.remove("open");var a=document.querySelector("[data-naked-select-id='".concat(n,"'][data-index='").concat(e,"'] .options-wrap"));a.style.height="0",a.setAttribute("tabindex","-1"),setTimeout(function(){o[t].classList.remove("dropup")},255)}},e=0;e<o.length;e++)t(e)})},toggle:function(){_toConsumableArray(s.querySelectorAll("".concat(u,"[data-naked-select]"))).forEach(function(o){o.getAttribute("data-initialized")||_toConsumableArray(o.querySelectorAll(".toggle-dropdown")).forEach(function(t){var e=t.parentNode.getAttribute("data-naked-select"),a=s.querySelector("".concat(u,"[data-naked-select='").concat(e,"']")),r=s.querySelector("".concat(u,"[data-naked-select='").concat(e,"'] .options-wrap"));r.style.height="0",t.addEventListener("click",function(t){if(t.preventDefault(),a.classList.contains("open"))a.classList.remove("open"),r.style.height="0",r.setAttribute("tabindex","-1"),t.target.parentNode.classList.remove("dropup"),o.querySelector(".naked-submit")&&o.querySelector(".naked-submit").setAttribute("tabindex","-1");else{a.classList.add("open"),r.style.height=null,r.setAttribute("tabindex","0");var e=window.innerHeight,n=window.scrollY;e-(window.scrollY+t.target.getBoundingClientRect().top+t.target.offsetHeight)+n<b&&(t.target.parentNode.classList.add("dropup"),t.target.nextSibling.style.bottom="".concat(t.target.offsetHeight,"px")),o.querySelector(".naked-submit")&&o.querySelector(".naked-submit").setAttribute("tabindex","0")}}),o.setAttribute("data-initialized","true")},v.globalClose())})},addValidationMessage:function(t){if(!t.querySelector(".naked-form-select-wrap--error-message")){t.classList.add("error");var e=document.createElement("div");e.classList.add("naked-form-select-wrap--error-message"),e.textContent="Please make a selection",t.insertBefore(e,t.childNodes[0])}},removeValidationMessage:function(t){if(t.classList.contains("error")){t.classList.remove("error");var e=t.querySelector(".naked-form-select-wrap--error-message");t.removeChild(e)}},validationError:function(n){n.closest("form").querySelector('[type="submit"]').addEventListener("click",function(t){var e=n.parentNode;n.checkValidity()?v.removeValidationMessage(e):v.addValidationMessage(e)})},select:function(){_toConsumableArray(s.querySelectorAll("".concat(u,"[data-naked-select] li"))).forEach(function(d){d.addEventListener("click",function(){var t=parseInt(d.getAttribute("data-index")),e=d.textContent,n=d.parentNode.getAttribute("data-naked-select-list"),a=s.querySelector("".concat(u,"[data-naked-select='").concat(n,"'] select"));a.options[t].selected=!0,v.triggerEvent(a,"change");var r=s.querySelector("".concat(u,"[data-naked-select='").concat(n,"'] .toggle-dropdown"));if(a.multiple){d.classList.contains("selected")?(d.classList.remove("selected"),a.options[t].selected=!1):(d.classList.add("selected"),a.options[t].selected=!0);var o,i=Array.from(a.options).filter(function(t){return!0===t.selected});if("true"===a.getAttribute("data-label")&&(i=i.filter(function(t){return 0!==t.index})),1<i.length)i.forEach(function(t){"true"===a.getAttribute("data-label")&&0===t.index||a.previousElementSibling.querySelector('li[data-index="'.concat(t.index,'"]')).classList.add("selected")}),o=null!==a.getAttribute("data-multiple-keyword")&&"false"===a.getAttribute("data-pluralize")?a.getAttribute("data-multiple-keyword"):null!==a.getAttribute("data-multiple-keyword")?"".concat(a.getAttribute("data-multiple-keyword"),"s"):"items",r.textContent="".concat(i.length," ").concat(o," selected");else 1===i.length&&(r.textContent=i[0].text);0===i.length&&(r.textContent=a.options[0].textContent)}else{var c=s.querySelector("".concat(u,"[data-naked-select='").concat(n,"']")),l=s.querySelector("".concat(u,"[data-naked-select='").concat(n,"'] .options-wrap"));c.classList.contains("open")?(c.classList.remove("open"),l.style.height="0",l.setAttribute("tabindex","-1")):(c.classList.add("open"),l.style.height=null,l.setAttribute("tabindex","0")),_toConsumableArray(s.querySelectorAll("".concat(u,"[data-naked-select='").concat(n,"'] li"))).forEach(function(t){t.classList.remove("selected")}),d.classList.contains("selected")?d.classList.remove("selected"):d.classList.add("selected"),r.textContent=e}a.getAttribute("required")&&0!==a.selectedIndex&&v.removeValidationMessage(s.querySelector("".concat(u,"[data-naked-select='").concat(n,"']")))})})},keywordSearch:function(){!0===m.on&&(_toConsumableArray(s.querySelectorAll(u)).forEach(function(t){t.setAttribute("keywordSearch","on")}),_toConsumableArray(s.querySelectorAll(f)).forEach(function(t,a){var e=[],r=Array.from(t.childNodes).filter(function(t){return"OPTION"===t.nodeName});r.forEach(function(t){e.push(t.textContent)});var n=t.previousElementSibling.childNodes[0].childNodes[0],o=(t.previousElementSibling.childNodes[1],_toConsumableArray(s.querySelectorAll("[data-naked-select-id='".concat(f,"'] .options-wrap li"))));o.forEach(function(t){t.classList.add("match")}),n.addEventListener("input",function(t){var e=t.target.value.toLowerCase(),n=r.filter(function(t){if(t.textContent.toLowerCase().match(e))return t});o.forEach(function(t){t.classList.remove("match")}),n.forEach(function(e){o.forEach(function(t){parseInt(t.getAttribute("data-index"))===e.index&&t.classList.add("match")})}),s.querySelector("".concat(u,"[data-naked-select='").concat(a,"'] .options-wrap")).style.height=null})}))}};s=void 0!==c.value&&!1===c.queryDocument?c.value:void 0!==c.value&&!0===c.queryDocument?document.querySelector(c.value):document,u="[data-naked-select-id='".concat(f=n,"']"),g.lists(),g.currentState(),v.toggle(),v.select(),v.keywordSearch()};module.exports=nakedFormSelect;