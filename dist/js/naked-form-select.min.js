/* Naked Form Select v1.1.4 (https://github.com/developerdayo/naked-form-select)
 * Copyright 2019-2020 Sarah Ferguson
 * Licensed under MIT (https://github.com/developerdayo/naked-form-select/LICENSE) */
"use strict";var nakedFormSelect=function(e,t){var s,f,u,n=0<arguments.length&&void 0!==e?e:"select",a=1<arguments.length&&void 0!==t?t:{},o=a.settings,r=void 0===o?{dropupThreshold:50}:o,i=a.context,c=void 0===i?{value:void 0,queryDocument:!1}:i,l=a.keywordSearch,p=void 0===l?{on:!1,placeholder:void 0}:l,d=a.submitBtn,m=void 0===d?{on:!1,text:void 0}:d;void 0===c.queryDocument?c.queryDocument=!1:c.queryDocument=c.queryDocument;var g=r.dropupThreshold,v={index:function(){setTimeout(function(){s.querySelectorAll("[data-naked-select-id]").forEach(function(e,t){e.setAttribute("data-index",t)})},1)},submitBtn:function(){var e,t=document.createElement("button");return e=void 0===m.text?m.text="submit":m.text,t.textContent=e,t.classList.add("naked-submit"),t.setAttribute("tabindex","-1"),t.addEventListener("click",function(e){e.target.closest("form").submit()}),t},keywordSearchInput:function(){var e=document.createElement("div");e.classList.add("keyword-search-wrap");var t=document.createElement("input");return t.setAttribute("aria-label","Enter a keyword to reduce the list of options"),void 0!==p.placeholder&&t.setAttribute("placeholder",p.placeholder),e.appendChild(t),e},lists:function(){s.querySelectorAll(f).forEach(function(e,t){if(!e.getAttribute("data-initialized")){var n,a=Array.from(e.childNodes).filter(function(e){return"OPTION"===e.nodeName});"true"===e.getAttribute("data-label")&&(n=a[0],a.shift());var o,r=[];a.forEach(function(e){r.push([e.index,e.textContent])}),o="true"===e.getAttribute("data-label")?n.textContent:a[0].textContent;var i=document.createElement("button");i.classList.add("toggle-dropdown"),i.setAttribute("aria-label","Click to expand options"),i.textContent=o,i.setAttribute("type","button");var c=document.createElement("div");c.classList.add("options-wrap"),c.setAttribute("tabindex","-1");var l=document.createElement("ul");l.setAttribute("data-naked-select-list",t),r.forEach(function(e){var t=document.createElement("li");t.setAttribute("data-index",e[0]),t.appendChild(document.createTextNode(e[1])),l.appendChild(t)}),c.appendChild(l);var d=document.createElement("div");if(d.classList.add("naked-form-select-wrap"),d.setAttribute("data-naked-select-id",f),d.setAttribute("data-naked-select",t),d.appendChild(i),d.appendChild(c),e.parentNode.insertBefore(d,e),d.appendChild(e),!0===p.on){var s=v.keywordSearchInput();l.insertAdjacentElement("beforebegin",s)}if(!0===m.on){var u=v.submitBtn();l.insertAdjacentElement("afterend",u)}b.validationError(e),v.index()}})},currentState:function(){s.querySelectorAll("".concat(u,"[data-naked-select] select")).forEach(function(t,e){if(!t.getAttribute("data-initialized")){var n=Array.from(t.parentNode.childNodes).filter(function(e){return e.classList.contains("toggle-dropdown")})[0];if(t.multiple){var a=Array.from(t.options).filter(function(e){return!0===e.selected});"true"===t.getAttribute("data-label")&&(a=a.filter(function(e){return 0!==e.index}));var o,r=t.options.selectedIndex;a.forEach(function(e){t.previousElementSibling.querySelector("li[data-index='".concat(e.index,"']")).classList.add("selected")}),-1===t.options.selectedIndex?n.textContent=t.options[0].textContent:"false"===t.getAttribute("data-pluralize")&&null!==t.getAttribute("data-multiple-keyword")&&1<a.length?(o=t.getAttribute("data-multiple-keyword"),n.textContent="".concat(a.length," ").concat(o," selected")):null!==t.getAttribute("data-multiple-keyword")&&1<a.length?(o=t.getAttribute("data-multiple-keyword")+"s",n.textContent="".concat(a.length," ").concat(o," selected")):1<a.length?(o="items",n.textContent="".concat(a.length," ").concat(o," selected")):(o="items",n.textContent=t.options[r].textContent)}else{var i=t.options.selectedIndex;"true"===t.getAttribute("data-label")&&0===i?n.textContent=t.options[0].textContent:(n.textContent=t.options[i].textContent,t.previousElementSibling.querySelector('li[data-index="'.concat(i,'"]')).classList.add("selected"))}t.setAttribute("data-initialized","true")}})}},b={triggerEvent:function(e,t){if("createEvent"in document){var n=document.createEvent("HTMLEvents");n.initEvent(t,!1,!0),e.dispatchEvent(n)}},globalClose:function(){document.querySelector("body").addEventListener("click",function(o){for(var r=Array.from(document.querySelectorAll("[data-naked-select]")),e=function(e){if(r[e].classList.contains("open")&&!r[e].contains(o.target)){var t=parseInt(r[e].getAttribute("data-index")),n=r[e].getAttribute("data-naked-select-id");r[e].classList.remove("open");var a=document.querySelector("[data-naked-select-id='".concat(n,"'][data-index='").concat(t,"'] .options-wrap"));a.style.height="0",a.setAttribute("tabindex","-1"),setTimeout(function(){r[e].classList.remove("dropup")},255)}},t=0;t<r.length;t++)e(t)})},toggle:function(){s.querySelectorAll("".concat(u,"[data-naked-select]")).forEach(function(r){r.getAttribute("data-initialized")||r.querySelectorAll(".toggle-dropdown").forEach(function(e){var t=e.parentNode.getAttribute("data-naked-select"),a=s.querySelector("".concat(u,"[data-naked-select='").concat(t,"']")),o=s.querySelector("".concat(u,"[data-naked-select='").concat(t,"'] .options-wrap"));o.style.height="0",e.addEventListener("click",function(e){if(e.preventDefault(),a.classList.contains("open"))a.classList.remove("open"),o.style.height="0",o.setAttribute("tabindex","-1"),e.target.parentNode.classList.remove("dropup"),r.querySelector(".naked-submit")&&r.querySelector(".naked-submit").setAttribute("tabindex","-1");else{a.classList.add("open"),o.style.height=null,o.setAttribute("tabindex","0");var t=window.innerHeight,n=window.scrollY;t-(window.scrollY+e.target.getBoundingClientRect().top+e.target.offsetHeight)+n<g&&(e.target.parentNode.classList.add("dropup"),e.target.nextSibling.style.bottom="".concat(e.target.offsetHeight,"px")),r.querySelector(".naked-submit")&&r.querySelector(".naked-submit").setAttribute("tabindex","0")}}),r.setAttribute("data-initialized","true")},b.globalClose())})},addValidationMessage:function(e){if(!e.querySelector(".naked-form-select-wrap--error-message")){e.classList.add("error");var t=document.createElement("div");t.classList.add("naked-form-select-wrap--error-message"),t.textContent="Please make a selection",e.insertBefore(t,e.childNodes[0])}},removeValidationMessage:function(e){if(e.classList.contains("error")){e.classList.remove("error");var t=e.querySelector(".naked-form-select-wrap--error-message");e.removeChild(t)}},validationError:function(n){n.closest("form").querySelector('[type="submit"]').addEventListener("click",function(e){var t=n.parentNode;n.checkValidity()?b.removeValidationMessage(t):b.addValidationMessage(t)})},select:function(){s.querySelectorAll("".concat(u,"[data-naked-select] li")).forEach(function(d){d.addEventListener("click",function(){var e=parseInt(d.getAttribute("data-index")),t=d.textContent,n=d.parentNode.getAttribute("data-naked-select-list"),a=s.querySelector("".concat(u,"[data-naked-select='").concat(n,"'] select"));a.options[e].selected=!0,b.triggerEvent(a,"change");var o=s.querySelector("".concat(u,"[data-naked-select='").concat(n,"'] .toggle-dropdown"));if(a.multiple){d.classList.contains("selected")?(d.classList.remove("selected"),a.options[e].selected=!1):(d.classList.add("selected"),a.options[e].selected=!0);var r,i=Array.from(a.options).filter(function(e){return!0===e.selected});if("true"===a.getAttribute("data-label")&&(i=i.filter(function(e){return 0!==e.index})),1<i.length)i.forEach(function(e){"true"===a.getAttribute("data-label")&&0===e.index||a.previousElementSibling.querySelector('li[data-index="'.concat(e.index,'"]')).classList.add("selected")}),r=null!==a.getAttribute("data-multiple-keyword")&&"false"===a.getAttribute("data-pluralize")?a.getAttribute("data-multiple-keyword"):null!==a.getAttribute("data-multiple-keyword")?"".concat(a.getAttribute("data-multiple-keyword"),"s"):"items",o.textContent="".concat(i.length," ").concat(r," selected");else 1===i.length&&(o.textContent=i[0].text);0===i.length&&(o.textContent=a.options[0].textContent)}else{var c=s.querySelector("".concat(u,"[data-naked-select='").concat(n,"']")),l=s.querySelector("".concat(u,"[data-naked-select='").concat(n,"'] .options-wrap"));c.classList.contains("open")?(c.classList.remove("open"),l.style.height="0",l.setAttribute("tabindex","-1")):(c.classList.add("open"),l.style.height=null,l.setAttribute("tabindex","0")),s.querySelectorAll("".concat(u,"[data-naked-select='").concat(n,"'] li")).forEach(function(e){e.classList.remove("selected")}),d.classList.contains("selected")?d.classList.remove("selected"):d.classList.add("selected"),o.textContent=t}a.getAttribute("required")&&0!==a.selectedIndex&&b.removeValidationMessage(s.querySelector("".concat(u,"[data-naked-select='").concat(n,"']")))})})},keywordSearch:function(){!0===p.on&&(s.querySelectorAll(u).forEach(function(e){e.setAttribute("keywordSearch","on")}),s.querySelectorAll(f).forEach(function(e,a){var t=[],o=Array.from(e.childNodes).filter(function(e){return"OPTION"===e.nodeName});o.forEach(function(e){t.push(e.textContent)});var n=e.previousElementSibling.childNodes[0].childNodes[0],r=(e.previousElementSibling.childNodes[1],s.querySelectorAll("[data-naked-select-id='".concat(f,"'] .options-wrap li")));r.forEach(function(e){e.classList.add("match")}),n.addEventListener("input",function(e){var t=e.target.value.toLowerCase(),n=o.filter(function(e){if(e.textContent.toLowerCase().match(t))return e});r.forEach(function(e){e.classList.remove("match")}),n.forEach(function(t){r.forEach(function(e){parseInt(e.getAttribute("data-index"))===t.index&&e.classList.add("match")})}),s.querySelector("".concat(u,"[data-naked-select='").concat(a,"'] .options-wrap")).style.height=null})}))}};s=void 0!==c.value&&!1===c.queryDocument?c.value:void 0!==c.value&&!0===c.queryDocument?document.querySelector(c.value):document,u="[data-naked-select-id='".concat(f=n,"']"),v.lists(),v.currentState(),b.toggle(),b.select(),b.keywordSearch()};module.exports=nakedFormSelect;